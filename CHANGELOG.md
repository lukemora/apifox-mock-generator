# 更新日志

所有重要的项目变更都会记录在这个文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [2.0.1] - 2026-01-12

### 🐛 修复

- **修复 operationId 导致的生成错误文件路径问题** - 解决使用 operationId 生成文件名时可能出现的路径错误
  - 移除 `pathToFileName` 函数中对 `operationId` 的依赖，改为直接使用 API 路径生成文件名
  - 简化文件路径生成逻辑：移除开头的斜杠和路径参数占位符，清理连续斜杠
  - 移除基于 HTTP 方法的后缀添加逻辑（如 /list, /create 等），统一使用路径作为文件名
  - 简化 `groupEndpointsByPath` 函数，直接使用路径作为分组键，不再需要提取资源路径
  - 修复 `wrapMockTemplate` 函数，添加 `fieldType` 参数以正确处理字符串类型的引号包裹
  - 清理测试文件中的版本号前缀，统一测试描述格式

**修复前**：使用 operationId 可能导致文件名包含特殊字符或格式不一致  
**修复后**：直接使用 API 路径，确保文件路径生成的一致性和可靠性

## [2.0.0] - 2026-01-08

### 🎯 重大更新

这是一个重大版本更新，引入了全新的架构设计和多项核心功能改进。

### ✨ 新增功能

#### 🏗️ 项目架构重构

- **依赖注入容器** - 引入依赖注入（DI）容器，优化服务注册和解析
  - 实现基于接口的服务注册机制，提升代码解耦和可测试性
  - 支持服务标识符常量管理，统一服务注册和解析
  - 提供容器设置和初始化功能，简化依赖管理

- **用例模式（Use Cases）** - 新增多个用例类，负责处理核心业务逻辑
  - `FetchApifoxDataUseCase` - 处理从 Apifox 获取 OpenAPI 文档
  - `GenerateMockUseCase` - 处理 Mock 文件生成
  - `GenerateTypesUseCase` - 处理 TypeScript 类型生成
  - `ServeMockUseCase` - 处理 Mock 服务器启动
  - 每个用例专注于单一职责，提升代码可维护性

- **领域驱动设计（DDD）架构** - 重构项目结构，采用分层架构
  - **domain/** - 领域层：实体、服务接口、业务逻辑
  - **application/** - 应用层：用例实现
  - **infrastructure/** - 基础设施层：具体实现（文件系统、日志、HTTP 客户端等）
  - **presentation/** - 表现层：HTTP 服务器、中间件等
  - 清晰的层次划分，提升代码组织性和可维护性

- **统一文件系统接口** - 实现统一的文件系统操作接口
  - 新增 `IFileSystem` 接口和 `FileSystemImpl` 实现
  - 替代原有的分散文件操作工具，统一文件操作方式
  - 支持依赖注入，便于测试和替换

#### 🛡️ 统一错误处理机制

- **错误类体系** - 新增统一的错误处理类
  - `ApifoxError` - 基础错误类
  - `ConfigError` - 配置错误类
  - `NetworkError` - 网络错误类
  - `ApifoxApiError` - Apifox API 错误类
  - 所有错误类支持详细的错误信息和建议

- **错误码系统** - 引入错误码常量定义
  - 统一的错误码管理（`ERROR_CODES`）
  - 错误码到 HTTP 状态码的映射（`ERROR_TO_HTTP_STATUS`）
  - 便于错误管理和调试

- **错误处理中间件** - 新增 Express 错误处理中间件
  - 统一的错误响应格式
  - 自动转换错误码为 HTTP 状态码
  - 提供详细的错误信息和建议

#### 📝 类型安全增强

- **OpenAPI 类型定义** - 引入完整的 OpenAPI 类型定义
  - `OpenAPIDocument` - OpenAPI 文档类型
  - `OpenAPISchema` - Schema 类型定义
  - 将多个函数的参数和返回值类型从 `any` 修改为具体的 OpenAPI 类型
  - 提升类型安全，减少类型不匹配的风险

#### 🧪 测试支持

- **E2E 测试框架** - 新增端到端测试支持
  - 使用 Vitest 作为测试框架
  - 支持配置测试、生成文件测试、Mock 服务器测试
  - 提供测试辅助工具和帮助函数
  - 新增测试脚本：`test:e2e`、`test:e2e:config`、`test:e2e:mock`

### 🔄 重构改进

- **路由管理器重构** - 将路由管理器迁移到基础设施层
  - 实现 `IRouteManager` 接口
  - 支持依赖注入，便于测试和替换

- **日志系统重构** - 重构日志系统为接口实现
  - 新增 `ILogger` 接口和 `ConsoleLoggerImpl` 实现
  - 支持依赖注入，便于替换日志实现

- **服务接口抽象** - 新增多个服务接口
  - `IApifoxClient` - Apifox 客户端接口
  - `IRouteManager` - 路由管理器接口
  - `IFileSystem` - 文件系统接口
  - `ILogger` - 日志接口
  - `IHttpClient` - HTTP 客户端接口

- **代码组织优化** - 优化代码组织结构
  - 多个模块文件路径发生变化（内部重构，不影响用户使用）
    - `src/server/` → `src/infrastructure/server/` 或 `src/presentation/http/`
    - `src/utils/logger.ts` → `src/infrastructure/logger/console-logger.impl.ts`
    - `src/utils/file-operations.ts` → `src/infrastructure/file-system/file-system.impl.ts`
  - 移除不再使用的代码和模块
  - 统一导出文件，简化导入路径
  - 提升代码整洁度和可维护性
  - 注意：这些是内部重构，用户通过配置文件（`apifox.config.json`、`mock.config.js`）和命令行工具使用，不受影响

### 📖 文档更新

- **架构设计文档** - 新增架构设计文档（`doc/ARCHITECTURE_DESIGN.md`）
  - 提供项目整体结构说明
  - 详细的功能模块介绍
  - 依赖注入使用指南

## [1.4.6] - 2025-12-09

### 🐛 修复

- **修复代理接口响应状态码不一致问题** - 修复代理接口与实际接口响应状态码不一致的问题
  - 修改为完全透明代理，完全原样返回响应
  - 确保代理响应包含原始状态码、响应头和响应体
  - 禁用 axios 的状态码验证，让所有响应都被视为成功并原样返回

### ✨ 新增

- **Apifox API 基础 URL 配置支持** - 增加可选的 Apifox API 基础 URL 配置
  - 在 `apifox.config.json` 中新增 `apiUrl` 配置项（可选，默认：`https://api.apifox.com`）
  - 支持自定义 Apifox API 服务器地址，适用于私有部署或内网环境
  - 更新相关文档和配置文件示例

- **路径前缀配置支持** - 添加路径前缀配置支持，优化路由匹配逻辑
  - 在 `mock.config.js` 中新增 `pathPrefixes` 配置项（可选）
  - 支持单个字符串或字符串数组配置
  - 用于处理生成路径与真实请求的前缀差异，兼容项目接口前缀
  - 优化路由匹配逻辑，自动处理路径前缀的添加和移除

## [1.4.5] - 2025-11-05

### 🐛 修复

- **优化类型命名空间生成逻辑** - 优化类型命名空间生成逻辑，支持路径参数以避免同名接口冲突
  - 在生成命名空间名称时，将路径参数（如 `{id}`, `{userId}` 等）纳入考虑
  - 通过路径参数区分同名接口，避免类型定义冲突
  - 提升类型生成的准确性和可靠性

## [1.4.4] - 2025-11-03

### 🐛 修复

- **修复同名接口可能错误匹配的问题** - 解决在路由匹配时同名接口可能出现错误匹配的问题
  - 优化路由匹配逻辑，确保精确匹配
  - 提升路由识别的准确性和可靠性
  - 避免同名接口之间的冲突和误判

## [1.4.3] - 2025-11-03

### 🐛 修复

- **修复接口递归循环引用问题** - 解决接口递归循环引用造成的栈溢出和重复 type 生成问题
  - 优化 Mock 模板生成器，添加循环引用检测机制
  - 优化 Type 模板生成器，避免重复生成相同的类型定义
  - 提升代码生成的稳定性和准确性

## [1.4.2] - 2025-10-31

### 🐛 修复

- **处理联调时业务code造成的代理失败问题** - 确保代理错误穿透到调用方
  - 只处理网络错误或其他异常
  - 完整返回响应体
  - 确保 `$ref` 引用能正确处理 URL 编码的中文字符

- \*\* 处理联调时业务code造成的代理失败，只处理网络错误或其他异常， 完整返回响应体

## [1.4.1] - 2025-10-31

### 🐛 修复

- **引用 Schema 名称解码问题** - 修复引用 schema 名称解码问题，确保正确处理 URL 编码的 schema 名称
  - 解决数据模型变量中包含中文时的引用问题
  - 优化类型模板生成器中的引用名称解码逻辑
  - 确保 `$ref` 引用能正确处理 URL 编码的中文字符

- \*\* 处理联调时业务code造成的代理失败，只处理网络错误或其他异常， 完整返回响应体

## [1.4.0] - 2025-10-30

### ✨ 新增

- **生成范围配置** - 添加生成范围配置功能，支持更精确地控制生成的 Mock 和类型文件范围
- **分支配置支持** - 添加 Apifox 分支配置支持，允许从指定分支拉取 API 数据，提升多分支开发体验
  - 在 `apifox.config.json` 中新增 `branchId` 配置项
  - 支持从不同分支拉取 API 定义，便于多环境开发和测试

### 🐛 修复

- **Mapping 读取错误** - 修复 mapping 文件读取导致的生成报错问题
  - 将 `apifox-mock-mappings.json` 迁移为 `apifox-mock-mappings.ts`
  - 优化 mock mappings 加载器，提升配置文件的可维护性和类型安全

### 🔧 改进

- **API 过滤逻辑优化** - 优化 API 过滤逻辑，提升过滤准确性和性能
- **请求体构建简化** - 简化 Apifox 客户端的请求体构建逻辑，提升代码可读性
- **Mock 配置归拢** - 删除逐一配置接口使用远程还是本地的方式，统一归拢到 `mock.config.js` 中处理
  - 简化配置结构，减少配置复杂度
  - 提升配置的统一管理和维护性
  - 优化 mock 配置加载器、模板生成器、远程代理和路由处理等模块

### 📖 文档更新

- 更新 README.md，添加分支配置说明和使用示例
- 更新配置文件示例，展示生成范围配置的用法

## [1.3.8] - 2025-10-30

### ✨ 新增

- 补充 Apifox 模板映射规则，完善常用模板到 Mock.js 的转换（`apifox-mock-mappings.json`）。
- 查询参数支持枚举与复杂类型的类型/Mock 生成能力。

### 🐛 修复

- 修复当接口仅查询参数不同却生成同名 `check_` 变量的问题，避免路由校验冲突。
- 修复“待确定”的中文枚举处理问题，确保类型与 Mock 生成稳定。

### 🔧 改进

- 端点过滤支持 `folderPaths` 匹配多级目录，过滤范围更精确。

## [1.3.7] - 2025-10-23

### 🐛 错误修复

#### 🔧 代理请求错误处理与响应逻辑改进

- **错误处理优化** - 改进代理请求的错误处理机制，提供更准确的错误信息
- **响应逻辑增强** - 优化代理请求的响应逻辑，确保响应数据正确传递
- **代理稳定性提升** - 进一步提升代理服务器的稳定性和可靠性

#### 🚀 技术改进

- **错误处理机制完善** - 完善代理请求的错误处理机制，减少错误传播
- **响应数据完整性** - 确保代理响应数据的完整性和准确性
- **代理性能优化** - 优化代理请求的处理性能，提升响应速度

## [1.3.6] - 2025-10-23

### 🐛 错误修复

#### 🔧 代理服务器请求头过滤修复

- **请求头过滤问题修复** - 修复代理服务器存在的请求头过滤问题，确保请求头正确传递
- **日志环境适配** - 修改日志根据环境生成，提升不同环境下的日志输出质量
- **代理稳定性改进** - 优化代理服务器的稳定性，减少请求头丢失问题

#### 🚀 技术改进

- **请求头处理优化** - 改进请求头处理逻辑，确保所有必要的请求头都能正确传递
- **环境适配增强** - 增强日志系统对不同环境的适配能力
- **错误处理完善** - 完善代理服务器的错误处理机制

## [1.3.5] - 2025-10-21

### 🐛 错误修复

#### 🔧 远程代理和热重载功能增强

- **远程代理修复** - 修复远程代理功能，确保远程服务器请求正常工作
- **热重载切换优化** - 改进热重载功能，支持远程/本地数据源动态切换
- **端口清理功能** - 添加端口清理功能，解决端口占用问题，提升服务器启动稳定性
- **代理配置优化** - 优化远程代理配置，提升代理请求的可靠性

#### 🚀 稳定性改进

- **错误处理增强** - 改进错误处理逻辑，提供更详细的错误信息
- **连接管理优化** - 优化连接管理，避免连接泄漏问题
- **性能提升** - 提升热重载和远程代理的性能表现

## [1.3.4] - 2025-10-21

### 🐛 错误修复

    修复mockjs和eslint生产依赖
    调整生成mock文件符合eslint规则

## [1.3.3] - 2025-10-18

### 🐛 错误修复

#### 🔥 热重载功能增强

- **文件监控改进** - 启用文件监控的轮询功能，确保文件变化被及时检测，解决在某些环境下文件变化检测不准确的问题
- **模块缓存清除** - 添加模块缓存清除功能，避免旧模块影响新路由加载，确保热重载时路由更新正确
- **错误处理优化** - 增强错误处理逻辑，提供更详细的错误信息，便于调试和问题定位
- **路由移除优化** - 优化路由移除逻辑，记录已移除的路由数量，提升热重载的可靠性

#### 📝 类型模板生成优化

- **重复生成修复** - 新增检查逻辑，识别标准响应体 schema，避免重复生成接口，解决类型文件冗余问题
- **ResData 类型处理** - 更新 ResData 类型处理逻辑，确保 null 类型的正确生成，提升类型定义的准确性
- **嵌套接口优化** - 优化嵌套接口生成逻辑，提升代码生成的准确性和一致性
- **模板生成稳定性** - 改进类型模板生成的整体稳定性，减少生成过程中的错误

## [1.3.2] - 2025-10-18

### 🐛 错误修复

- **引用解析修复** - 修复引用解析逻辑，确保正确解码引用名称，避免引用类型处理错误
- **数组类型处理增强** - 增强数组类型处理，支持空对象和引用类型的数组元素，提升复杂数据结构的 Mock 生成准确性
- **默认值处理优化** - 提供合理的默认值处理，避免返回 null，确保 Mock 数据生成的完整性和可用性

## [1.3.1] - 2025-10-18

### 🐛 错误修复

#### 🔧 配置和构建优化

- **package.json 更新** - 更新项目依赖和配置
- **构建优化** - 改进项目构建流程
- **版本管理** - 统一版本管理策略

### 🚀 技术改进

- **依赖更新** - 更新相关依赖包版本
- **构建稳定性** - 提升构建过程的稳定性
- **代码质量** - 持续改进代码质量

### 🔄 重构改进

#### 📝 接口名称优化

- **请求参数接口** - 更新请求参数接口名称以提高一致性
- **查询参数接口** - 更新查询参数接口名称以提高一致性
- **接口命名规范** - 统一接口命名规范，提升代码可读性
- **类型定义优化** - 优化类型定义结构，提高开发体验

## [1.3.0] - 2025-10-18

### 🎯 核心功能改进

#### 🔧 重复生成问题修复

- **修复重复引入问题** - 解决重复生成 mock 文件时的重复引入问题
- **OpenAPI 转换器优化** - 修复参数处理逻辑，避免重复生成
- **导入语句去重** - 新增导入语句去重功能，解决重复生成导致的代码冗余
- **类型模板优化** - 改进类型模板生成逻辑，避免重复定义接口
- **块更新器集成** - 集成去重功能到块更新器，确保代码质量

#### 🏗️ Mock 配置系统重构

- **动态配置支持** - 新增 `mock.config.js` 动态配置文件
- **配置结构简化** - 移除 `apifox.config.json` 中的 `mockPort` 配置
- **专注开发环境** - 简化配置结构，专注开发环境使用
- **文档完善** - 完善 README 配置说明和工作流程

#### 🎨 代码质量提升

- **Prettier 格式化** - 使用 Prettier 格式化整个项目代码
- **统一代码风格** - 统一代码格式风格，提高代码可读性
- **配置规则应用** - 应用 `.prettierrc.json` 配置规则
- **多文件格式化** - 格式化所有 TypeScript、JSON、Markdown 文件
- **风格一致性** - 保持代码风格一致性

#### 🔄 路由加载器增强

- **check\_ 函数支持** - 修复路由加载器支持 `check_` 函数动态选择数据源
- **RemoteProxy 类** - 新增 RemoteProxy 类，支持代理请求到远程服务器
- **代理功能完善** - 支持路径重写、请求头配置、超时设置等功能
- **热重载支持** - 在热重载功能中也添加对 `check_` 函数的支持
- **类型定义更新** - 更新类型定义，添加 `remoteServer` 配置选项
- **文档更新** - 完善 README 文档，添加远程代理配置说明

#### 🎯 配置系统优化

- **配置参数简化** - 简化配置参数并优化端点过滤逻辑
- **文档更新** - 更新 README 文档，移除过时的配置参数说明
- **scope 配置简化** - 简化 scope 配置，移除 `excludeDeprecated` 和 `operationId` 相关参数
- **请求体构建优化** - 优化 `apifox-client` 请求体构建，支持 `folderPaths` 配置
- **过滤逻辑重构** - 重构 `endpoint-filter` 过滤逻辑，移除冗余的 `operationId` 过滤
- **调试功能增强** - 添加 OpenAPI 数据保存功能，便于调试和日志记录
- **废弃接口处理** - 统一废弃接口过滤逻辑，默认排除所有废弃接口
- **工具文件新增** - 新增 `file-utils` 工具文件，提供文件操作和 OpenAPI 数据保存功能

#### 🛠️ 路由处理改进

- **单文件多路由支持** - 改进路由加载器支持单文件多路由
- **路由提取功能** - 修复路由提取功能，支持单个 mock 文件中的多个路由
- **路由解析优化** - 新增 `extractAllRouteInfo` 函数用于更好的路由解析
- **路由匹配改进** - 改进路由匹配逻辑，支持 PostRole、GetRole 等命名模式
- **路由加载修复** - 修复路由加载逻辑，现在能遍历文件中的所有路由

#### 🔧 类型生成器修复

- **Apifox 数据模型支持** - 修复类型生成器处理 Apifox 数据模型的问题
- **中文 schema 名称支持** - 修复处理中文 schema 名称的问题

### 📖 文档更新

- **README 配置说明** - 完善配置说明和工作流程
- **远程代理配置** - 添加远程代理配置说明
- **配置参数更新** - 移除过时的配置参数说明

### 🚀 技术改进

- **代码格式化** - 统一代码格式风格
- **错误处理** - 改进错误处理和日志输出
- **性能优化** - 优化路由加载和匹配性能
- **类型安全** - 增强类型定义和类型安全

## [1.2.0] - 2025-10-16

### 🎯 核心功能改进

#### 🏗️ Mock 文件架构优化

- **新增文件架构管理** - 引入 `file-architecture.ts` 模块，统一管理 Mock 文件的基础结构
- **两步生成模式** - Mock 文件生成改为两步模式：先确保文件架构，后生成接口内容
- **智能架构检测** - 自动检测现有文件是否包含必要的 import 语句，避免重复添加
- **增量架构更新** - 对于已存在的文件，智能添加缺失的基础架构而不覆盖现有内容

#### 🔧 代码质量提升

- **代码格式化优化** - 改进 `code-formatter.ts`，使用 Prettier 自动格式化生成的代码
- **统一代码风格** - 所有生成的 Mock 文件都遵循统一的代码风格和格式
- **更好的可读性** - 生成的代码更加整洁，便于维护和调试

#### 📊 类型系统增强

- **接口状态支持** - 在 `ApiEndpoint` 类型中新增 `status` 字段，支持接口状态管理
- **更精确的类型定义** - 优化类型注释，提供更清晰的 API 文档
- **废弃配置优化** - 改进 `excludedByTags` 的注释说明，明确其用于排除接口状态

### 🚀 技术改进

#### 📁 文件管理优化

- **目录结构自动创建** - 生成 Mock 文件时自动创建必要的目录结构
- **文件存在性检查** - 增强文件存在性检查，避免文件操作错误
- **架构完整性保证** - 确保每个 Mock 文件都包含必要的 import 语句和基础设置

#### 🎨 代码生成改进

- **模块化架构** - 将文件架构管理独立为单独模块，提高代码复用性
- **更好的错误处理** - 改进文件操作过程中的错误处理和日志输出
- **增量更新支持** - 支持在现有文件中增量添加新的接口定义

### 📖 文档更新

### 📋 执行前提条件

执行 `node dist/src/scripts/serve-mock.js` 需要满足以下条件：

3. **配置文件存在** - 确保 `apifox.config.json` 在项目根目录
4. **Mock 文件已生成** - 先运行 `npm run generate` 生成 Mock 文件
5. **Mock 目录存在** - 确保 `mock/` 目录存在且包含有效的 Mock 文件
6. **端口可用** - 确保配置的 `mockPort` 端口未被占用

---

## [1.1.0] - 2025-10-13

### 🎯 核心功能

#### 🎭 直接使用 Apifox Mock 规则

- **使用 Apifox 配置** - 直接使用 Apifox 中为字段配置的 mock 规则
- **统一管理** - Mock 规则在 Apifox 平台统一管理，本地与云端保持完全一致
- **零配置** - 在 Apifox 中配置好 mock 规则，生成时自动应用

### ✨ 新增功能

#### 🔄 Apifox Mock 规则支持

- **x-apifox-mock 字段** - 自动提取 Apifox 的 `x-apifox-mock` 扩展字段中的 mock 规则
- **智能语法转换** - 自动将 Apifox 模板语法（`{{$xxx}}`）转换为 Mock.js 语法（`@xxx`）
- **双语法支持** - 同时支持 Mock.js 语法和 Apifox 模板语法
- **自动应用** - 启用 `includeApifoxExtensionProperties` 后自动拉取和应用规则

支持的 Apifox 模板转换：

- `{{$string.uuid}}` → `@guid`
- `{{$person.fullName(locale='zh_CN')}}` → `@cname`
- `{{$internet.email}}` → `@email`
- `{{$phone.number}}` → `/^1[3-9]\\d{9}$/`
- 更多模板映射...

#### 📊 回退策略

当字段没有配置 Apifox mock 规则时，使用以下回退策略：

1. **示例值优先** - 使用 schema 中定义的 `example`
2. **枚举值** - 使用 `enum` 中的值（通过 `@pick` 随机选择）
3. **基本规则** - 根据字段类型使用简单的默认规则
   - 字符串：`@cword(3, 8)`
   - 数字/整数：根据 `minimum/maximum` 生成范围
   - 布尔值：`@boolean`

### 📖 文档更新

- **README.md** - 新增"Apifox Mock 规则"章节
  - 说明工作原理和使用方法
  - 提供使用示例
  - 更新项目结构说明
- **CHANGELOG.md** - 详细记录所有变更

### 🎯 优势

- ✅ **统一管理** - 在 Apifox 中统一管理所有 mock 规则，团队协作更方便
- ✅ **完全一致** - 本地 Mock 数据与 Apifox 云端 Mock 保持一致
- ✅ **零学习成本** - 使用 Apifox 原生的 mock 规则，无需学习新语法
- ✅ **功能完整** - 支持 Apifox 的所有 mock 规则和高级功能

### 🚀 使用示例

在 Apifox 中配置字段的 mock 规则：

```
字段名: email
类型: string
Mock 规则: @email
```

生成的 Mock 文件会自动应用该规则：

```javascript
Mock.mock({
  email: '@email' // 直接使用 Apifox 配置的规则
});
```

### ⚡ 兼容性

- 向下兼容 v1.0.0
- 无需修改配置文件
- 自动应用 Apifox mock 规则

---

## [1.0.0] - 2025-10-10

### ✨ 初始版本发布

#### 核心功能

- 🚀 **Apifox API 客户端** - 从 Apifox 项目拉取 API 接口定义
- 📝 **类型生成器** - 自动生成 TypeScript 类型文件（.ts 格式）
- 🎭 **Mock 生成器** - 基于 Schema 自动生成 Mock 数据文件
- 🌐 **Mock 服务器** - 基于 Express 的本地 Mock 服务
- 🔥 **热重载** - 修改 Mock 文件自动生效，无需重启服务器
- 🎯 **API 筛选** - 支持多种筛选规则精确控制导出的 API
  - 路径模式筛选（支持通配符 `*` 和 `**`）
  - HTTP 方法筛选
  - Apifox 标签筛选
  - 操作 ID 筛选
  - 排除废弃接口
- ⚡ **增量更新** - 智能识别文件变化，仅更新必要的内容
- 🎨 **代码格式化** - 使用 Prettier 格式化生成的代码

#### 命令行工具

- `npm run build` - 编译 TypeScript 代码
- `npm run generate` - 拉取 API 并生成 Mock 和类型文件
- `npm run serve` - 启动 Mock 服务器
- `npm run dev` - 开发模式（生成 + 服务器）

#### 服务器功能

- 🌐 **Express 服务器** - 快速响应的本地 Mock 服务
- 🔄 **动态路由** - 自动发现和加载 Mock 路由，零配置
- 🎯 **路由匹配** - 支持路径参数、查询参数、请求体
- ✅ **参数校验** - 基于 Schema 的请求参数验证
- 🔥 **文件监听** - 监听 Mock 文件变化并自动重载
- 🌍 **CORS 支持** - 跨域请求支持

#### 代码架构

- **core/** - 核心模块
  - `apifox-client.ts` - Apifox API 客户端
  - `config-loader.ts` - 配置加载器
  - `endpoint-filter.ts` - API 端点筛选器
  - `openapi-converter.ts` - OpenAPI 数据转换器
- **generators/** - 生成器模块
  - `mock-generator.ts` - Mock 文件生成器
  - `type-generator.ts` - TypeScript 类型生成器
  - `templates/` - 代码生成模板
- **server/** - Mock 服务器模块
  - `express-server.ts` - Express 服务器配置
  - `hot-reload.ts` - 热重载功能
  - `route-loader.ts` - 路由加载器
  - `route-manager.ts` - 路由管理器
  - `route-matcher.ts` - 路由匹配器
  - `validation.ts` - 参数校验
- **utils/** - 工具模块
  - `block-updater.ts` - 增量更新工具
  - `code-formatter.ts` - 代码格式化（Prettier）
  - `file-operations.ts` - 文件操作封装
  - `logger.ts` - 彩色日志工具
  - `path-utils.ts` - 路径处理工具
  - `type-mapping.ts` - OpenAPI 到 TypeScript 类型映射

#### 配置文件

- **apifox.config.json** - Apifox 项目配置和 API 筛选规则
  - `projectId` - Apifox 项目 ID
  - `token` - Apifox 访问令牌
  - `mockDir` - Mock 文件输出目录
  - `typesDir` - 类型文件输出目录
  - `mockPort` - Mock 服务器端口
  - `apiFilter` - API 筛选配置（服务端 + 客户端双重过滤）
- **tsconfig.json** - TypeScript 编译配置
- **package.json** - 项目依赖和脚本

#### 技术栈

- **语言**: TypeScript 5.3+
- **运行时**: Node.js 16+
- **Web 框架**: Express 4.x
- **HTTP 客户端**: Axios
- **Mock 数据**: @faker-js/faker, Mock.js
- **文件监听**: Chokidar
- **代码格式化**: Prettier
- **日志工具**: Chalk
- **API 工具**: Apifox CLI

#### 支持的 OpenAPI 特性

- ✅ OpenAPI 3.0 规范
- ✅ HTTP 方法：GET、POST、PUT、DELETE、PATCH
- ✅ 路径参数 (Path Parameters)
- ✅ 查询参数 (Query Parameters)
- ✅ 请求头 (Headers)
- ✅ 请求体 (Request Body)
- ✅ 响应体 (Response Body)
- ✅ 复杂对象类型
- ✅ 数组类型和嵌套数组
- ✅ 枚举类型 (enum)
- ✅ 嵌套对象和深层嵌套
- ✅ Schema 引用 ($ref)
- ✅ allOf / anyOf / oneOf
- ✅ 必填字段和可选字段

#### 已知限制

- ⚠️ 暂不支持 OpenAPI 2.0 (Swagger)
- ⚠️ 暂不支持文件上传/下载类型
- ⚠️ 暂不支持 WebSocket
- ⚠️ 暂不支持 GraphQL

### 📚 文档

- `README.md` - 完整的项目说明和使用指南
- `CHANGELOG.md` - 版本更新日志
- `apifox.config.json` - 详细的配置示例

## 贡献

欢迎贡献代码、报告问题或提出建议！

## 许可证

MIT License - 详见 [LICENSE](./LICENSE) 文件
